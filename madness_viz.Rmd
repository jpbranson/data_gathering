---
title: "madness_viz"
output: html_document
date: '2022-03-18'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(rvest)
```

```{r}

mad.df <- data.frame(stringsAsFactors = F)
for (i in seq_along(list.files(path = "data/madness/", pattern = ".html"))) {
  mad.df <- list.files(path = "data/madness/", pattern = ".html")[i] %>%
    paste0("data/madness/",.) %>%
  read_html() %>%
  html_table() %>%
  pluck(1) %>%
  tail(-2) %>%
    mutate(name = list.files(path = "data/madness/", pattern = ".html")[i]) %>%
    bind_rows(mad.df, .)
}

colnames(mad.df) <- c("name", "prob_first", "prob_second", "prob_third", "points", "rank", "file")
  
```

```{r}
mad.df.clean <- mad.df %>%
  mutate(time = str_replace(file, "X", ""),
         time = str_replace(time, ".html", ""),
         time = parse_date_time(time, "%Y.%m.%d.%H.%M.%S") %>% with_tz(tzone = "US/Central")) %>%
  mutate(across(.cols = c("prob_first", "prob_second", "prob_third", "points", "rank"), .fns = as.numeric))
  
```

```{r}
{mad.df.clean %>%
  pivot_longer(cols = c("prob_first", "prob_second", "prob_third", "points", "rank"), names_to = "metric") %>%
  ggplot(aes(x = time, y = value, col = name)) +
  geom_line() +
  facet_grid(rows = vars(metric), scales = "free_y") } %>% plotly::ggplotly() %>% htmlwidgets::saveWidget(file = "madness_viz.html")
```

```{r}
mad.df.clean %>%
  pivot_longer(cols = c("prob_first", "prob_second", "prob_third", "points", "rank"), names_to = "metric") %>%
  ggplot(aes(x = time, y = value, col = name)) +
  geom_smooth(method = "loess", se =F) +
  facet_grid(rows = vars(metric), scales = "free_y")
```

